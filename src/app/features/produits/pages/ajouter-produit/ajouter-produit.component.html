<div class="container-fluid py-4">
  <div class="row justify-content-center">
    <div class="col-lg-10">
      <div class="card shadow-sm">
        <div class="card-header bg-primary text-white">
          <h3 class="card-title mb-0">
            <i class="fas fa-plus-circle me-2"></i>
            Ajouter un Nouveau Produit
          </h3>
        </div>

        <div class="card-body">
          <form [formGroup]="produitForm" (ngSubmit)="onSubmit()" novalidate>

            <!-- Informations g√©n√©rales du produit -->
            <div class="row">
              <div class="col-md-8">
                <h5 class="mb-3">Informations du Produit</h5>

                <!-- Nom du produit -->
                <div class="mb-3">
                  <label for="nom" class="form-label">Nom du Produit *</label>
                  <input
                    type="text"
                    class="form-control"
                    id="nom"
                    formControlName="nom"
                    placeholder="Entrez le nom du produit"
                    [class.is-invalid]="nom?.invalid && nom?.touched">
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('nom')">
                    {{getFieldError('nom')}}
                  </div>
                </div>

                <!-- Description -->
                <div class="mb-3">
                  <label for="description" class="form-label">Description *</label>
                  <textarea
                    class="form-control"
                    id="description"
                    rows="4"
                    formControlName="description"
                    placeholder="D√©crivez votre produit en d√©tail..."
                    [class.is-invalid]="description?.invalid && description?.touched">
                  </textarea>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('description')">
                    {{getFieldError('description')}}
                  </div>
                </div>

                <!-- Prix et Stock -->
                <div class="row">
                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="prix" class="form-label">Prix (FCFA) *</label>
                      <input
                        type="number"
                        class="form-control"
                        id="prix"
                        formControlName="prix"
                        placeholder="0"
                        min="0"
                        step="0.01"
                        [class.is-invalid]="prix?.invalid && prix?.touched">
                      <div class="invalid-feedback" *ngIf="isFieldInvalid('prix')">
                        {{getFieldError('prix')}}
                      </div>
                    </div>
                  </div>

                  <div class="col-md-6">
                    <div class="mb-3">
                      <label for="stock" class="form-label">Stock *</label>
                      <input
                        type="number"
                        class="form-control"
                        id="stock"
                        formControlName="stock"
                        placeholder="0"
                        min="0"
                        [class.is-invalid]="stock?.invalid && stock?.touched">
                      <div class="invalid-feedback" *ngIf="isFieldInvalid('stock')">
                        {{getFieldError('stock')}}
                      </div>
                    </div>
                  </div>
                </div>

                <!-- Cat√©gorie -->
                <div class="mb-3">
                  <label for="categorie" class="form-label">Cat√©gorie *</label>
                  <select
                    class="form-select"
                    id="categorie"
                    formControlName="categorie"
                    [class.is-invalid]="categorie?.invalid && categorie?.touched">
                    <option value="">S√©lectionnez une cat√©gorie</option>
                    <option *ngFor="let cat of categories" [value]="cat.name">
                      {{ cat.name }}
                    </option>
                  </select>
                  <div class="invalid-feedback" *ngIf="isFieldInvalid('categorie')">
                    {{getFieldError('categorie')}}
                  </div>
                </div>
              </div>

              <!-- Section Photo -->
              <div class="col-md-4">
                <h5 class="mb-3">Photo du Produit</h5>

                <!-- Zone d'upload d'image -->
                <div class="mb-3" *ngIf="!photoUrl">
                  <div class="upload-container">
                    <div class="upload-placeholder">
                      <i class="fas fa-cloud-upload-alt fa-3x text-muted mb-2"></i>
                      <p class="text-muted">S√©lectionnez une photo du produit</p>
                    </div>
                  </div>

                  <!-- Input file cach√© -->
                  <input
                    type="file"
                    #fileInput
                    accept="image/*"
                    capture="environment"
                    (change)="onFileSelected($event)"
                    style="display: none;">

                  <!-- Boutons d'upload -->
                  <div class="d-grid gap-2 mt-2">
                    <button
                      type="button"
                      class="btn btn-outline-primary"
                      (click)="fileInput.click()"
                      [disabled]="isUploading">
                      <i class="fas fa-camera me-2"></i>
                      üì∏ Prendre une photo r√©elle
                    </button>

                    <button
                      type="button"
                      class="btn btn-outline-secondary"
                      (click)="fileInput.click()"
                      [disabled]="isUploading">
                      <i class="fas fa-folder me-2"></i>
                      Choisir depuis la galerie
                    </button>
                  </div>

                  <!-- Loader pendant l'upload -->
                  <div *ngIf="isUploading" class="upload-loader mt-2">
                    <div class="d-flex align-items-center">
                      <div class="spinner-border spinner-border-sm me-2" role="status">
                        <span class="visually-hidden">Envoi...</span>
                      </div>
                      <span>Envoi de l'image en cours...</span>
                    </div>
                  </div>

                  <!-- Message d'erreur -->
                  <div *ngIf="uploadError" class="alert alert-danger mt-2" role="alert">
                    <i class="fas fa-exclamation-triangle me-1"></i>
                    {{ uploadError }}
                  </div>
                </div>

                <!-- Aper√ßu de la photo s√©lectionn√©e -->
                <div *ngIf="photoUrl" class="photo-preview-container">
                  <h6>Photo s√©lectionn√©e:</h6>
                  <img [src]="previewUrl" alt="Photo du produit" class="img-fluid rounded mb-2">

                  <!-- Bouton pour supprimer la photo -->
                  <button
                    type="button"
                    class="btn btn-outline-danger btn-sm mt-2"
                    (click)="removeImage()">
                    <i class="fas fa-trash me-1"></i>
                    Supprimer la photo
                  </button>
                </div>
              </div>
            </div>

            <!-- Bouton de soumission -->
            <div class="row mt-4">
              <div class="col-12">
                <div class="d-grid">
                  <button
                    type="submit"
                    class="btn btn-primary btn-lg"
                    [disabled]="produitForm.invalid || !capturedPhoto || isSubmitting">
                    <i class="fas fa-save me-2" *ngIf="!isSubmitting"></i>
                    <i class="fas fa-spinner fa-spin me-2" *ngIf="isSubmitting"></i>
                    {{ isSubmitting ? 'Ajout...' : 'Ajouter le Produit' }}
                  </button>
                </div>
              </div>
            </div>
          </form>
        </div>
      </div>
    </div>
  </div>
</div>